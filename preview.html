<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>资产管理（内嵌 JSON 版）</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f6fa; }
    h2 { margin-top: 30px; color: #333; }
    form, .filter-sort { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 400px; margin-bottom: 20px; }
    form input, form button, .filter-sort input, .filter-sort select, .filter-sort button { margin: 5px 0 15px; padding: 8px; width: 100%; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    form button { background: #4CAF50; color: #fff; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
    form button:hover { background: #45a049; }
    .items-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
    .item-card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.2s; position: relative; }
    .item-card:hover { transform: translateY(-4px); }
    .item-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
    .item-info div { margin: 3px 0; font-size: 14px; color: #444; }
    .delete-btn { position: absolute; top: 8px; right: 8px; background: #e74c3c; color: #fff; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-weight: bold; line-height: 20px; text-align: center; }
    .edit-btn { position: absolute; top: 8px; right: 40px; background: #f39c12; color: #fff; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-weight: bold; line-height: 20px; text-align: center; }
    .summary { margin-top: 30px; font-weight: bold; font-size: 16px; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .download-btn { margin-top: 10px; background: #2196F3; color: #fff; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .download-btn:hover { background: #1976D2; }
  </style>
</head>
<body>
  <h2>添加物品</h2>
  <form id="itemForm">
    名称: <input type="text" id="name" required>
    购买日期: <input type="date" id="date" required>
    价格: <input type="number" id="price" required>
    预计使用天数: <input type="number" id="days" required>
    图片文件名: <input type="text" id="image" placeholder="例如：item1.jpg">
    <button type="submit">添加</button>
  </form>

  <h2>筛选与排序</h2>
  <div class="filter-sort">
    名称关键词: <input type="text" id="filterName" placeholder="请输入名称">
    剩余天数 ≤ <input type="number" id="filterDays" placeholder="不限">
    排序方式:
    <select id="sortSelect">
      <option value="">无</option>
      <option value="valueAsc">折旧后价值升序</option>
      <option value="valueDesc">折旧后价值降序</option>
      <option value="priceAsc">原价升序</option>
      <option value="priceDesc">原价降序</option>
      <option value="remainAsc">剩余天数升序</option>
      <option value="remainDesc">剩余天数降序</option>
    </select>
    <button onclick="applyFilterSort()">应用</button>
  </div>

  <h2>物品列表</h2>
  <div id="items" class="items-container"></div>

  <div class="summary" id="summary"></div>
  <button class="download-btn" id="downloadBtn">下载物品数据 (items.json)</button>

  <script>
    const form = document.getElementById("itemForm");
    const itemsDiv = document.getElementById("items");
    const summaryDiv = document.getElementById("summary");
    const downloadBtn = document.getElementById("downloadBtn");

    // 内嵌 JSON 数据（你可以把本地 items.json 的内容直接替换下面数组）
    let items = [];

fetch("items.json")
  .then(res => res.json())
  .then(data => {
    items = data;
    renderItems();
    updateSummary();
  });


    renderItems();
    updateSummary();

    form.addEventListener("submit", function(e){
      e.preventDefault();
      const name = document.getElementById("name").value;
      const date = new Date(document.getElementById("date").value);
      const price = parseFloat(document.getElementById("price").value);
      const days = parseInt(document.getElementById("days").value);
      const imgSrc = document.getElementById("image").value.trim();

      const today = new Date();
      const usedDays = Math.floor((today - date)/(1000*60*60*24));
      const remainDays = Math.max(days - usedDays,0);
      const avg = usedDays>0 ? (price/usedDays).toFixed(2) : "0";
      const currentValue = (price*remainDays/days).toFixed(2);

      const item = { name, price, days, imgSrc, date: date.getTime(), usedDays, remainDays, avg, currentValue };
      items.push(item);
      renderItems();
      updateSummary();
      form.reset();
    });

    function renderItems(){
      itemsDiv.innerHTML = "";
      items.forEach((item,index)=>{
        const card = document.createElement("div");
        card.className = "item-card";
        card.innerHTML = `
          <button class="delete-btn" onclick="deleteItem(${index})">×</button>
          <button class="edit-btn" onclick="editItem(${index})">✎</button>
          <img src="./${item.imgSrc}" alt="图片">
          <div class="item-info">
            <div><b>${item.name}</b></div>
            <div>已使用天数: ${item.usedDays}</div>
            <div>剩余使用天数: ${item.remainDays}</div>
            <div>平均每天花费: ￥${item.avg}</div>
            <div>当前价值: ￥${item.currentValue}</div>
          </div>
        `;
        itemsDiv.appendChild(card);
      });
    }

    function updateSummary(){
      const totalPrice = items.reduce((sum,i)=>sum+i.price,0).toFixed(2);
      const totalValue = items.reduce((sum,i)=>sum+parseFloat(i.currentValue),0).toFixed(2);
      summaryDiv.innerHTML = `资产原值总和: ￥${totalPrice} | 折旧后资产总和: ￥${totalValue}`;
    }

    function deleteItem(index){
      if(!confirm("确定删除此物品吗？")) return;
      items.splice(index,1);
      renderItems();
      updateSummary();
    }

    function editItem(index){
      const item = items[index];
      const newName = prompt("修改名称:", item.name);
      if(newName !== null) item.name = newName;

      const newDateStr = prompt("修改购买日期(YYYY-MM-DD):", new Date(item.date).toISOString().slice(0,10));
      if(newDateStr){
        const newDate = new Date(newDateStr);
        const today = new Date();
        item.date = newDate.getTime();
        item.usedDays = Math.floor((today - newDate)/(1000*60*60*24));
        item.remainDays = Math.max(item.days - item.usedDays,0);
        item.avg = item.usedDays>0 ? (item.price/item.usedDays).toFixed(2) : "0";
        item.currentValue = (item.price*item.remainDays/item.days).toFixed(2);
      }

      const newPriceStr = prompt("修改价格:", item.price);
      if(newPriceStr !== null){
        item.price = parseFloat(newPriceStr);
        item.avg = item.usedDays>0 ? (item.price/item.usedDays).toFixed(2) : "0";
        item.currentValue = (item.price*item.remainDays/item.days).toFixed(2);
      }

      const newDaysStr = prompt("修改预计使用天数:", item.days);
      if(newDaysStr !== null){
        item.days = parseInt(newDaysStr);
        item.remainDays = Math.max(item.days - item.usedDays,0);
        item.currentValue = (item.price*item.remainDays/item.days).toFixed(2);
      }

      const newImg = prompt("修改图片文件名:", item.imgSrc);
      if(newImg !== null) item.imgSrc = newImg;

      renderItems();
      updateSummary();
    }

    function applyFilterSort(){
      let filtered = [...items];
      const keyword = document.getElementById("filterName").value.trim().toLowerCase();
      if(keyword) filtered = filtered.filter(i=>i.name.toLowerCase().includes(keyword));
      const maxDays = parseInt(document.getElementById("filterDays").value);
      if(!isNaN(maxDays)) filtered = filtered.filter(i=>i.remainDays <= maxDays);
      const sortMode = document.getElementById("sortSelect").value;
      if(sortMode){
        if(sortMode==="valueAsc") filtered.sort((a,b)=>a.currentValue-b.currentValue);
        else if(sortMode==="valueDesc") filtered.sort((a,b)=>b.currentValue-a.currentValue);
        else if(sortMode==="priceAsc") filtered.sort((a,b)=>a.price-b.price);
        else if(sortMode==="priceDesc") filtered.sort((a,b)=>b.price-a.price);
        else if(sortMode==="remainAsc") filtered.sort((a,b)=>a.remainDays-b.remainDays);
        else if(sortMode==="remainDesc") filtered.sort((a,b)=>b.remainDays-a.remainDays);
      }
      renderFilteredItems(filtered);
    }

    function renderFilteredItems(filtered){
      itemsDiv.innerHTML = "";
      filtered.forEach((item)=>{
        const card = document.createElement("div");
        card.className = "item-card";
        card.innerHTML = `
          <button class="delete-btn" onclick="deleteItem(${items.indexOf(item)})">×</button>
          <button class="edit-btn" onclick="editItem(${items.indexOf(item)})">✎</button>
          <img src="./${item.imgSrc}" alt="图片">
          <div class="item-info">
            <div><b>${item.name}</b></div>
            <div>已使用天数: ${item.usedDays}</div>
            <div>剩余使用天数: ${item.remainDays}</div>
            <div>平均每天花费: ￥${item.avg}</div>
            <div>当前价值: ￥${item.currentValue}</div>
          </div>
        `;
        itemsDiv.appendChild(card);
      });
    }

    downloadBtn.addEventListener("click",function(){
      if(items.length===0) return alert("没有物品可保存！");
      const dataStr = JSON.stringify(items,null,2);
      const blob = new Blob([dataStr],{type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download="items.json";
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
